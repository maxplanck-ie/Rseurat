---
title: "Day2_Embeddings"
author: "Katarzyna Sikora"
date: "2/21/2023"
output: ioslides_presentation
---


## Outline

- Setup
- Dataset
- Embedding in lowD
- SessionInfo

## Setup

```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = '/data/manke/processing/sikora/Rseurat_wdir')
knitr::opts_chunk$set(fig.width=6, fig.height=4,message=FALSE,warning=FALSE) 
```

```{r seuratVersion,warning=FALSE,message=FALSE}
library(Seurat)
packageVersion("Seurat")

```


## SeuratData

```{r SeuratData,message=FALSE,warning=FALSE}
#devtools::install_github('satijalab/seurat-data')
library(SeuratData)
AvailableData()
InstallData("pbmc3k")
pbmc <- LoadData("pbmc3k", type = "pbmc3k.final")
pbmc[["pca"]]
```
## Determine the ‘dimensionality’ of the dataset: Jackstraw Plot

```{r jackstraw,message=FALSE,warning=FALSE,fig.width=5, fig.height=3.5}
pbmc <- JackStraw(pbmc, num.replicate = 100)
pbmc <- ScoreJackStraw(pbmc, dims = 1:20)
JackStrawPlot(pbmc, dims = 1:15)
```

## Determine the ‘dimensionality’ of the dataset: Elbow Plot

```{r elbow}
ElbowPlot(pbmc)
```

## Dimentional reduction and embedding in lowD

```{r umap,message=FALSE,warning=FALSE}
pbmc <- RunUMAP(pbmc, dims = 1:7)
DimPlot(pbmc, reduction = "umap",label=TRUE)
```

## Dimentional reduction: assignment

Rerun the UMAP calculation using a different number of PCs: 10, 15... What has changed?


## What do the components of the dimentional reduction mean?

```{r genes}
print(pbmc[["pca"]], dims = 1:5, nfeatures = 5)
```

## Visualize loadings

```{r loadings}
VizDimLoadings(pbmc, dims = 1:2, reduction = "pca")
```

## Visualize loadings

```{r dimHeatmap}
DimHeatmap(pbmc, dims = 1, cells = 500, balanced = TRUE)
```

## PC Loadings: assignment

Pick a principal component and run GO term enrichment on the genes loading it.


## Proposed solution: enrichR

```{r enrichR_calc}
library(enrichR)
setEnrichrSite("Enrichr")
dbs <- listEnrichrDbs()
dbs <- c("GO_Biological_Process_2015")
pc1<-Loadings(pbmc[["pca"]])[1:20,1]
enriched <- enrichr(names(pc1)[pc1>0], dbs)
```


## Proposed solution: plot

```{r plotEnrich}
plotEnrich(enriched[[1]], showTerms = 20, numChar = 40, y = "Count", orderBy = "P.value")
```

## SessionInfo

```{r sessionInfo}
sessionInfo()
```

## Citations
```{r citations}

```